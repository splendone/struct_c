<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>线性表顺序存储结构操作演示 - 同步高亮</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-top: 0;
            font-size: 1.5em;
        }
        
        .top-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .status {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 10px 0;
            flex-wrap: wrap;
            font-size: 0.8em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border: 1px solid #333;
        }
        
        .visualization-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .memory-visualization {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        
        .memory-unit {
            width: 40px;
            height: 40px;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 1px;
            position: relative;
            font-size: 0.9em;
        }
        
        .memory-unit.index {
            background-color: #ddd;
            font-size: 10px;
        }
        
        .occupied {
            background-color: #4CAF50;
            color: white;
        }
        
        .empty {
            background-color: #f0f0f0;
        }
        
        .highlight {
            background-color: #FFEB3B;
            color: black;
        }
        
        .insert-element {
            background-color: #2196F3;
            color: white;
        }
        
        .delete-element {
            background-color: #f44336;
            color: white;
        }
        
        .index-label {
            position: absolute;
            bottom: 1px;
            right: 1px;
            font-size: 8px;
            color: #666;
        }
        
        .controls {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background-color: #fafafa;
            border-radius: 5px;
        }
        
        .input-group {
            margin: 8px 5px;
            display: inline-block;
        }
        
        input, button {
            padding: 8px;
            margin: 4px;
            font-size: 14px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            min-width: 100px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .demo-buttons {
            margin-top: 10px;
        }
        
        .code-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .code-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .code-display {
            flex: 1;
            min-width: 300px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 12px;
            font-family: 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .code-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .insert-code {
            background-color: #e8f5e9; /* 浅绿色背景 */
        }
        
        .delete-code {
            background-color: #ffebee; /* 浅红色背景 */
        }
        
        @media (max-width: 900px) {
            .code-container {
                flex-direction: column;
            }
            
            .memory-unit {
                width: 30px;
                height: 30px;
                font-size: 0.8em;
            }
            
            .memory-unit.index {
                font-size: 8px;
            }
            
            .index-label {
                font-size: 7px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>线性表顺序存储结构操作演示</h1>
        
        <div class="top-section">
            <div class="status" id="status">当前列表长度: 0, 容量: 10</div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4CAF50;"></div>
                    <span>已存储元素</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f0f0f0;"></div>
                    <span>空闲位置</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FFEB3B;"></div>
                    <span>当前操作位置</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2196F3;"></div>
                    <span>插入元素</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f44336;"></div>
                    <span>删除元素</span>
                </div>
            </div>
        </div>
        
        <div class="visualization-section">
            <div class="memory-visualization" id="memoryViz"></div>
            
            <div class="controls">
                <div class="input-group">
                    <label>位置 (0-9): </label>
                    <input type="number" id="position" min="0" max="9" value="0" style="width: 60px;">
                </div>
                <div class="input-group">
                    <label>值: </label>
                    <input type="number" id="value" value="1" style="width: 60px;">
                </div>
                <br>
                <button onclick="insertElement()">插入元素</button>
                <button onclick="deleteElement()">删除元素</button>
                
                <div class="demo-buttons">
                    <button onclick="demoInsert()">插入演示</button>
                    <button onclick="demoDelete()">删除演示</button>
                </div>
            </div>
        </div>
        
        <div class="code-section">
            <div class="code-container">
                <div class="code-display insert-code">
                    <div class="code-title">插入操作代码 (ListInsert)</div>
                    <div id="insertCodeDisplay"></div>
                </div>
                <div class="code-display delete-code">
                    <div class="code-title">删除操作代码 (ListDelete)</div>
                    <div id="deleteCodeDisplay"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 线性表数据结构
        const MAXSIZE = 10;
        let linearList = {
            data: new Array(MAXSIZE).fill(null),
            length: 0
        };
        
        // 高亮状态
        let highlightPositions = [];
        let currentOperation = null;
        
        // 代码段定义
        const insertCode = [
            {line: 0, code: "// 插入操作", highlight: false},
            {line: 1, code: "Status ListInsert(SqList &L, int i, ElemType e){", highlight: false},
            {line: 2, code: "    if(i < 1 || i > L.length+1)", highlight: false},
            {line: 3, code: "        return ERROR;", highlight: false},
            {line: 4, code: "    if(L.length == MAXSIZE)", highlight: false},
            {line: 5, code: "        return ERROR;", highlight: false},
            {line: 6, code: "    for(j=L.length-1; j>=i-1; j--)", highlight: false},
            {line: 7, code: "        L.data[j+1] = L.data[j];", highlight: false},
            {line: 8, code: "    L.data[i-1] = e;", highlight: false},
            {line: 9, code: "    ++L.length;", highlight: false},
            {line: 10, code: "    return OK;", highlight: false},
            {line: 11, code: "}"}
        ];
        
        const deleteCode = [
            {line: 0, code: "// 删除操作", highlight: false},
            {line: 1, code: "Status ListDelete(SqList &L, int i, ElemType &e){", highlight: false},
            {line: 2, code: "    if(i < 1 || i > L.length)", highlight: false},
            {line: 3, code: "        return ERROR;", highlight: false},
            {line: 4, code: "    e = L.data[i-1];", highlight: false},
            {line: 5, code: "    for(j=i; j<L.length; j++)", highlight: false},
            {line: 6, code: "        L.data[j-1] = L.data[j];", highlight: false},
            {line: 7, code: "    L.length--;", highlight: false},
            {line: 8, code: "    return OK;", highlight: false},
            {line: 9, code: "}"}
        ];
        
        // 初始化内存可视化
        function initMemoryViz() {
            const container = document.getElementById('memoryViz');
            container.innerHTML = '';
            
            // 索引行
            for (let i = 0; i < MAXSIZE; i++) {
                const unit = document.createElement('div');
                unit.className = 'memory-unit index';
                unit.textContent = i;
                container.appendChild(unit);
            }
            
            // 数据行
            for (let i = 0; i < MAXSIZE; i++) {
                const unit = document.createElement('div');
                unit.className = 'memory-unit empty';
                unit.id = `mem-${i}`;
                
                const valueDiv = document.createElement('div');
                valueDiv.className = 'value';
                valueDiv.textContent = linearList.data[i] !== null ? linearList.data[i] : '';
                unit.appendChild(valueDiv);
                
                const indexLabel = document.createElement('div');
                indexLabel.className = 'index-label';
                indexLabel.textContent = i;
                unit.appendChild(indexLabel);
                
                container.appendChild(unit);
            }
        }
        
        // 更新内存显示
        function updateMemoryDisplay() {
            for (let i = 0; i < MAXSIZE; i++) {
                const unit = document.getElementById(`mem-${i}`);
                const valueDiv = unit.querySelector('.value');
                
                if (i < linearList.length) {
                    unit.className = 'memory-unit occupied';
                    valueDiv.textContent = linearList.data[i];
                } else {
                    unit.className = 'memory-unit empty';
                    valueDiv.textContent = '';
                }
                
                // 应用高亮
                if (highlightPositions.includes(i)) {
                    if (currentOperation === 'insert') {
                        unit.classList.add('insert-element');
                    } else if (currentOperation === 'delete') {
                        unit.classList.add('delete-element');
                    } else {
                        unit.classList.add('highlight');
                    }
                } else {
                    unit.classList.remove('highlight', 'insert-element', 'delete-element');
                }
            }
            
            // 更新状态
            document.getElementById('status').textContent = 
                `当前列表长度: ${linearList.length}, 容量: ${MAXSIZE}, 内容: [${linearList.data.slice(0, linearList.length).join(', ')}]`;
        }
        
        // 高亮代码行
        function highlightCode(operation, step) {
            let snippet;
            let displayId;
            
            if (operation === 'insert') {
                snippet = insertCode;
                displayId = 'insertCodeDisplay';
            } else if (operation === 'delete') {
                snippet = deleteCode;
                displayId = 'deleteCodeDisplay';
            } else {
                // 不高亮任何代码
                for (let i = 0; i < insertCode.length; i++) {
                    insertCode[i].highlight = false;
                }
                for (let i = 0; i < deleteCode.length; i++) {
                    deleteCode[i].highlight = false;
                }
                displayInsertCode();
                displayDeleteCode();
                return;
            }
            
            // 重置所有高亮
            for (let i = 0; i < snippet.length; i++) {
                snippet[i].highlight = false;
            }
            
            // 根据步骤高亮特定行
            if (operation === 'insert') {
                switch(step) {
                    case 'check_bounds':
                        insertCode[2].highlight = true;
                        insertCode[3].highlight = true;
                        break;
                    case 'check_full':
                        insertCode[4].highlight = true;
                        insertCode[5].highlight = true;
                        break;
                    case 'shift_elements':
                        insertCode[6].highlight = true;
                        insertCode[7].highlight = true;
                        break;
                    case 'insert_value':
                        insertCode[8].highlight = true;
                        break;
                    case 'update_length':
                        insertCode[9].highlight = true;
                        break;
                }
            } else if (operation === 'delete') {
                switch(step) {
                    case 'check_bounds':
                        deleteCode[2].highlight = true;
                        deleteCode[3].highlight = true;
                        break;
                    case 'save_value':
                        deleteCode[4].highlight = true;
                        break;
                    case 'shift_elements':
                        deleteCode[5].highlight = true;
                        deleteCode[6].highlight = true;
                        break;
                    case 'update_length':
                        deleteCode[7].highlight = true;
                        break;
                }
            }
            
            // 更新显示
            if (operation === 'insert') {
                displayInsertCode();
            } else if (operation === 'delete') {
                displayDeleteCode();
            }
        }
        
        // 显示插入代码
        function displayInsertCode() {
            const codeDisplay = document.getElementById('insertCodeDisplay');
            let codeHTML = '';
            for (let i = 0; i < insertCode.length; i++) {
                const line = insertCode[i];
                if (line.highlight) {
                    codeHTML += `<span style="background-color: #FFEB3B; display: block;">${line.code}</span>`;
                } else {
                    codeHTML += `<div>${line.code}</div>`;
                }
            }
            codeDisplay.innerHTML = codeHTML;
        }
        
        // 显示删除代码
        function displayDeleteCode() {
            const codeDisplay = document.getElementById('deleteCodeDisplay');
            let codeHTML = '';
            for (let i = 0; i < deleteCode.length; i++) {
                const line = deleteCode[i];
                if (line.highlight) {
                    codeHTML += `<span style="background-color: #FFEB3B; display: block;">${line.code}</span>`;
                } else {
                    codeHTML += `<div>${line.code}</div>`;
                }
            }
            codeDisplay.innerHTML = codeHTML;
        }
        
        // 插入元素
        async function insertElement() {
            const posInput = document.getElementById('position');
            const valInput = document.getElementById('value');
            
            let pos = parseInt(posInput.value);
            const val = parseInt(valInput.value);
            
            if (isNaN(pos) || isNaN(val)) {
                alert("请输入有效的位置和值！");
                return;
            }
            
            if (pos < 0 || pos > linearList.length) {
                alert(`位置必须在 0 到 ${linearList.length} 之间！`);
                return;
            }
            
            if (linearList.length >= MAXSIZE) {
                alert("线性表已满，无法插入！");
                return;
            }
            
            // 开始插入操作
            currentOperation = 'insert';
            
            // 高亮边界检查
            highlightCode('insert', 'check_bounds');
            await sleep(1000);
            
            // 高亮满检查
            highlightCode('insert', 'check_full');
            await sleep(1000);
            
            // 移动元素
            for (let j = linearList.length - 1; j >= pos; j--) {
                linearList.data[j + 1] = linearList.data[j];
                highlightPositions = [j, j + 1]; // 高亮正在移动的元素
                updateMemoryDisplay();
                highlightCode('insert', 'shift_elements');
                await sleep(800);
            }
            
            // 插入新值
            linearList.data[pos] = val;
            linearList.length++;
            highlightPositions = [pos];
            updateMemoryDisplay();
            highlightCode('insert', 'insert_value');
            await sleep(800);
            
            // 更新长度
            highlightCode('insert', 'update_length');
            await sleep(800);
            
            // 重置高亮状态
            highlightPositions = [];
            currentOperation = null;
            highlightCode(null, null); // 不高亮任何代码
            updateMemoryDisplay();
        }
        
        // 删除元素
        async function deleteElement() {
            const posInput = document.getElementById('position');
            let pos = parseInt(posInput.value);
            
            if (isNaN(pos)) {
                alert("请输入有效的位置！");
                return;
            }
            
            if (pos < 0 || pos >= linearList.length) {
                alert(`位置必须在 0 到 ${linearList.length - 1} 之间！`);
                return;
            }
            
            // 开始删除操作
            currentOperation = 'delete';
            
            // 高亮边界检查
            highlightCode('delete', 'check_bounds');
            await sleep(1000);
            
            // 保存被删除的值
            highlightCode('delete', 'save_value');
            highlightPositions = [pos];
            updateMemoryDisplay();
            await sleep(800);
            
            // 移动元素
            for (let j = pos; j < linearList.length - 1; j++) {
                linearList.data[j] = linearList.data[j + 1];
                highlightPositions = [j, j + 1]; // 高亮正在移动的元素
                updateMemoryDisplay();
                highlightCode('delete', 'shift_elements');
                await sleep(800);
            }
            
            // 清除最后位置的值
            linearList.data[linearList.length - 1] = null;
            linearList.length--;
            
            // 高亮更新长度
            highlightCode('delete', 'update_length');
            await sleep(800);
            
            // 重置高亮状态
            highlightPositions = [];
            currentOperation = null;
            highlightCode(null, null); // 不高亮任何代码
            updateMemoryDisplay();
        }
        
        // 演示插入操作
        async function demoInsert() {
            // 重置列表
            linearList.data = new Array(MAXSIZE).fill(null);
            linearList.length = 0;
            
            // 添加一些初始值
            for (let i = 0; i < 3; i++) {
                linearList.data[i] = i + 1;
                linearList.length++;
            }
            
            updateMemoryDisplay();
            highlightCode(null, null); // 不高亮任何代码
            await sleep(1000);
            
            // 演示在位置1插入值99
            document.getElementById('position').value = 1;
            document.getElementById('value').value = 99;
            await insertElement();
        }
        
        // 演示删除操作
        async function demoDelete() {
            // 重置列表
            linearList.data = new Array(MAXSIZE).fill(null);
            linearList.length = 0;
            
            // 添加一些初始值
            for (let i = 0; i < 5; i++) {
                linearList.data[i] = i + 1;
                linearList.length++;
            }
            
            updateMemoryDisplay();
            highlightCode(null, null); // 不高亮任何代码
            await sleep(1000);
            
            // 演示删除位置1的元素
            document.getElementById('position').value = 1;
            document.getElementById('value').value = 0; // 任意值
            await deleteElement();
        }
        
        // 辅助函数：延迟
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // 初始化
        window.onload = function() {
            initMemoryViz();
            updateMemoryDisplay();
            displayInsertCode();
            displayDeleteCode();
        };
    </script>
</body>
</html>